import{R as V,r as d}from"./chunks/index.e3977df9.js";import{j as O}from"./chunks/jsx-runtime.0ba51638.js";function Be(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function de(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function pe(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?de(Object(n),!0).forEach(function(r){Be(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Ne(t,e){if(t==null)return{};var n={},r=Object.keys(t),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(n[i]=t[i]);return n}function Ue(t,e){if(t==null)return{};var n=Ne(t,e),r,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(i=0;i<o.length;i++)r=o[i],!(e.indexOf(r)>=0)&&(!Object.prototype.propertyIsEnumerable.call(t,r)||(n[r]=t[r]))}return n}function He(t,e){return _e(t)||qe(t,e)||Fe(t,e)||We()}function _e(t){if(Array.isArray(t))return t}function qe(t,e){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(t)))){var n=[],r=!0,i=!1,o=void 0;try{for(var a=t[Symbol.iterator](),l;!(r=(l=a.next()).done)&&(n.push(l.value),!(e&&n.length===e));r=!0);}catch(h){i=!0,o=h}finally{try{!r&&a.return!=null&&a.return()}finally{if(i)throw o}}return n}}function Fe(t,e){if(!!t){if(typeof t=="string")return fe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fe(t,e)}}function fe(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function We(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ke(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function he(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),n.push.apply(n,r)}return n}function ge(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?he(Object(n),!0).forEach(function(r){ke(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):he(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function ze(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return function(r){return e.reduceRight(function(i,o){return o(i)},r)}}function q(t){return function e(){for(var n=this,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return i.length>=t.length?t.apply(this,i):function(){for(var a=arguments.length,l=new Array(a),h=0;h<a;h++)l[h]=arguments[h];return e.apply(n,[].concat(i,l))}}}function Z(t){return{}.toString.call(t).includes("Object")}function Je(t){return!Object.keys(t).length}function k(t){return typeof t=="function"}function Ke(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Qe(t,e){return Z(e)||D("changeType"),Object.keys(e).some(function(n){return!Ke(t,n)})&&D("changeField"),e}function Ye(t){k(t)||D("selectorType")}function Ge(t){k(t)||Z(t)||D("handlerType"),Z(t)&&Object.values(t).some(function(e){return!k(e)})&&D("handlersType")}function Xe(t){t||D("initialIsRequired"),Z(t)||D("initialType"),Je(t)&&D("initialContent")}function Ze(t,e){throw new Error(t[e]||t.default)}var et={initialIsRequired:"initial state is required",initialType:"initial state should be an object",initialContent:"initial state shouldn't be an empty object",handlerType:"handler should be an object or a function",handlersType:"all handlers should be a functions",selectorType:"selector should be a function",changeType:"provided value of changes should be an object",changeField:'it seams you want to change a field in the state which is not specified in the "initial" state',default:"an unknown error accured in `state-local` package"},D=q(Ze)(et),Q={changes:Qe,selector:Ye,handler:Ge,initial:Xe};function tt(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};Q.initial(t),Q.handler(e);var n={current:t},r=q(it)(n,e),i=q(rt)(n),o=q(Q.changes)(t),a=q(nt)(n);function l(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:function(p){return p};return Q.selector(g),g(n.current)}function h(g){ze(r,i,o,a)(g)}return[l,h]}function nt(t,e){return k(e)?e(t.current):e}function rt(t,e){return t.current=ge(ge({},t.current),e),e}function it(t,e,n){return k(e)?e(t.current):Object.keys(n).forEach(function(r){var i;return(i=e[r])===null||i===void 0?void 0:i.call(e,t.current[r])}),n}var ot={create:tt},st={paths:{vs:"https://cdn.jsdelivr.net/npm/monaco-editor@0.33.0/min/vs"}};function at(t){return function e(){for(var n=this,r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return i.length>=t.length?t.apply(this,i):function(){for(var a=arguments.length,l=new Array(a),h=0;h<a;h++)l[h]=arguments[h];return e.apply(n,[].concat(i,l))}}}function ct(t){return{}.toString.call(t).includes("Object")}function ut(t){return t||me("configIsRequired"),ct(t)||me("configType"),t.urls?(lt(),{paths:{vs:t.urls.monacoBase}}):t}function lt(){console.warn(Oe.deprecation)}function dt(t,e){throw new Error(t[e]||t.default)}var Oe={configIsRequired:"the configuration object is required",configType:"the configuration object should be an object",default:"an unknown error accured in `@monaco-editor/loader` package",deprecation:`Deprecation warning!
    You are using deprecated way of configuration.

    Instead of using
      monaco.config({ urls: { monacoBase: '...' } })
    use
      monaco.config({ paths: { vs: '...' } })

    For more please check the link https://github.com/suren-atoyan/monaco-loader#config
  `},me=at(dt)(Oe),pt={config:ut},ft=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return function(i){return n.reduceRight(function(o,a){return a(o)},i)}};function Me(t,e){return Object.keys(e).forEach(function(n){e[n]instanceof Object&&t[n]&&Object.assign(e[n],Me(t[n],e[n]))}),pe(pe({},t),e)}var ht={type:"cancelation",msg:"operation is manually canceled"};function ie(t){var e=!1,n=new Promise(function(r,i){t.then(function(o){return e?i(ht):r(o)}),t.catch(i)});return n.cancel=function(){return e=!0},n}var gt=ot.create({config:st,isInitialized:!1,resolve:null,reject:null,monaco:null}),Ee=He(gt,2),z=Ee[0],te=Ee[1];function mt(t){var e=pt.config(t),n=e.monaco,r=Ue(e,["monaco"]);te(function(i){return{config:Me(i.config,r),monaco:n}})}function vt(){var t=z(function(e){var n=e.monaco,r=e.isInitialized,i=e.resolve;return{monaco:n,isInitialized:r,resolve:i}});if(!t.isInitialized){if(te({isInitialized:!0}),t.monaco)return t.resolve(t.monaco),ie(oe);if(window.monaco&&window.monaco.editor)return Re(window.monaco),t.resolve(window.monaco),ie(oe);ft(bt,xt)(yt)}return ie(oe)}function bt(t){return document.body.appendChild(t)}function wt(t){var e=document.createElement("script");return t&&(e.src=t),e}function xt(t){var e=z(function(r){var i=r.config,o=r.reject;return{config:i,reject:o}}),n=wt("".concat(e.config.paths.vs,"/loader.js"));return n.onload=function(){return t()},n.onerror=e.reject,n}function yt(){var t=z(function(n){var r=n.config,i=n.resolve,o=n.reject;return{config:r,resolve:i,reject:o}}),e=window.require;e.config(t.config),e(["vs/editor/editor.main"],function(n){Re(n),t.resolve(n)},function(n){t.reject(n)})}function Re(t){z().monaco||te({monaco:t})}function Ot(){return z(function(t){var e=t.monaco;return e})}var oe=new Promise(function(t,e){return te({resolve:t,reject:e})}),je={config:mt,init:vt,__getMonacoInstance:Ot},s={exports:{}},Mt="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",Et=Mt,Rt=Et;function Ae(){}function Se(){}Se.resetWarningCache=Ae;var jt=function(){function t(r,i,o,a,l,h){if(h!==Rt){var g=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw g.name="Invariant Violation",g}}t.isRequired=t;function e(){return t}var n={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Se,resetWarningCache:Ae};return n.PropTypes=n,n};s.exports=jt();function ae(){return ae=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ae.apply(this,arguments)}const At={display:"flex",height:"100%",width:"100%",justifyContent:"center",alignItems:"center"};function St({content:t}){return V.createElement("div",{style:At},t)}const se={wrapper:{display:"flex",position:"relative",textAlign:"initial"},fullWidth:{width:"100%"},hide:{display:"none"}};function Ie({width:t,height:e,isEditorReady:n,loading:r,_ref:i,className:o,wrapperProps:a}){return V.createElement("section",ae({style:{...se.wrapper,width:t,height:e}},a),!n&&V.createElement(St,{content:r}),V.createElement("div",{ref:i,style:{...se.fullWidth,...!n&&se.hide},className:o}))}Ie.propTypes={width:s.exports.oneOfType([s.exports.number,s.exports.string]).isRequired,height:s.exports.oneOfType([s.exports.number,s.exports.string]).isRequired,loading:s.exports.oneOfType([s.exports.element,s.exports.string]).isRequired,isEditorReady:s.exports.bool.isRequired,className:s.exports.string,wrapperProps:s.exports.object};var Ce=d.exports.memo(Ie);function Pe(t){d.exports.useEffect(t,[])}function P(t,e,n=!0){const r=d.exports.useRef(!0);d.exports.useEffect(r.current||!n?()=>{r.current=!1}:t,e)}function F(){}function ee(t,e,n,r){return It(t,r)||Ct(t,e,n,r)}function It(t,e){return t.editor.getModel(Te(t,e))}function Ct(t,e,n,r){return t.editor.createModel(e,n,r&&Te(t,r))}function Te(t,e){return t.Uri.parse(e)}function Pt(t){return t===void 0}function De({original:t,modified:e,language:n,originalLanguage:r,modifiedLanguage:i,originalModelPath:o,modifiedModelPath:a,keepCurrentOriginalModel:l,keepCurrentModifiedModel:h,theme:g,loading:p,options:f,height:b,width:v,className:c,wrapperProps:C,beforeMount:T,onMount:B}){const[S,N]=d.exports.useState(!1),[L,M]=d.exports.useState(!0),I=d.exports.useRef(null),R=d.exports.useRef(null),J=d.exports.useRef(null),j=d.exports.useRef(B),m=d.exports.useRef(T);Pe(()=>{const w=je.init();return w.then(E=>(R.current=E)&&M(!1)).catch(E=>E?.type!=="cancelation"&&console.error("Monaco initialization: error:",E)),()=>I.current?ne():w.cancel()}),P(()=>{const w=I.current.getModifiedEditor();w.getOption(R.current.editor.EditorOption.readOnly)?w.setValue(e):e!==w.getValue()&&(w.executeEdits("",[{range:w.getModel().getFullModelRange(),text:e,forceMoveMarkers:!0}]),w.pushUndoStop())},[e],S),P(()=>{I.current.getModel().original.setValue(t)},[t],S),P(()=>{const{original:w,modified:E}=I.current.getModel();R.current.editor.setModelLanguage(w,r||n),R.current.editor.setModelLanguage(E,i||n)},[n,r,i],S),P(()=>{R.current.editor.setTheme(g)},[g],S),P(()=>{I.current.updateOptions(f)},[f],S);const U=d.exports.useCallback(()=>{m.current(R.current);const w=ee(R.current,t,r||n,o),E=ee(R.current,e,i||n,a);I.current.setModel({original:w,modified:E})},[n,e,i,t,r,o,a]),K=d.exports.useCallback(()=>{I.current=R.current.editor.createDiffEditor(J.current,{automaticLayout:!0,...f}),U(),R.current.editor.setTheme(g),N(!0)},[f,g,U]);d.exports.useEffect(()=>{S&&j.current(I.current,R.current)},[S]),d.exports.useEffect(()=>{!L&&!S&&K()},[L,S,K]);function ne(){const w=I.current.getModel();if(!l){var E;(E=w.original)===null||E===void 0||E.dispose()}if(!h){var H;(H=w.modified)===null||H===void 0||H.dispose()}I.current.dispose()}return V.createElement(Ce,{width:v,height:b,isEditorReady:S,loading:p,_ref:J,className:c,wrapperProps:C})}De.propTypes={original:s.exports.string,modified:s.exports.string,language:s.exports.string,originalLanguage:s.exports.string,modifiedLanguage:s.exports.string,originalModelPath:s.exports.string,modifiedModelPath:s.exports.string,keepCurrentOriginalModel:s.exports.bool,keepCurrentModifiedModel:s.exports.bool,theme:s.exports.string,loading:s.exports.oneOfType([s.exports.element,s.exports.string]),options:s.exports.object,width:s.exports.oneOfType([s.exports.number,s.exports.string]),height:s.exports.oneOfType([s.exports.number,s.exports.string]),className:s.exports.string,wrapperProps:s.exports.object,beforeMount:s.exports.func,onMount:s.exports.func};De.defaultProps={theme:"light",loading:"Loading...",options:{},keepCurrentOriginalModel:!1,keepCurrentModifiedModel:!1,width:"100%",height:"100%",wrapperProps:{},beforeMount:F,onMount:F};function Tt(t){const e=d.exports.useRef();return d.exports.useEffect(()=>{e.current=t},[t]),e.current}const Y=new Map;function ue({defaultValue:t,defaultLanguage:e,defaultPath:n,value:r,language:i,path:o,theme:a,line:l,loading:h,options:g,overrideServices:p,saveViewState:f,keepCurrentModel:b,width:v,height:c,className:C,wrapperProps:T,beforeMount:B,onMount:S,onChange:N,onValidate:L}){const[M,I]=d.exports.useState(!1),[R,J]=d.exports.useState(!0),j=d.exports.useRef(null),m=d.exports.useRef(null),U=d.exports.useRef(null),K=d.exports.useRef(S),ne=d.exports.useRef(B),w=d.exports.useRef(null),E=d.exports.useRef(r),H=Tt(o);Pe(()=>{const x=je.init();return x.then(y=>(j.current=y)&&J(!1)).catch(y=>y?.type!=="cancelation"&&console.error("Monaco initialization: error:",y)),()=>m.current?Ve():x.cancel()}),P(()=>{const x=ee(j.current,t||r,e||i,o);x!==m.current.getModel()&&(f&&Y.set(H,m.current.saveViewState()),m.current.setModel(x),f&&m.current.restoreViewState(Y.get(o)))},[o],M),P(()=>{m.current.updateOptions(g)},[g],M),P(()=>{m.current.getOption(j.current.editor.EditorOption.readOnly)?m.current.setValue(r):r!==m.current.getValue()&&(m.current.executeEdits("",[{range:m.current.getModel().getFullModelRange(),text:r,forceMoveMarkers:!0}]),m.current.pushUndoStop())},[r],M),P(()=>{j.current.editor.setModelLanguage(m.current.getModel(),i)},[i],M),P(()=>{Pt(l)||m.current.revealLine(l)},[l],M),P(()=>{j.current.editor.setTheme(a)},[a],M);const le=d.exports.useCallback(()=>{ne.current(j.current);const x=o||n,y=ee(j.current,r||t,e||i,x);m.current=j.current.editor.create(U.current,{model:y,automaticLayout:!0,...g},p),f&&m.current.restoreViewState(Y.get(x)),j.current.editor.setTheme(a),I(!0)},[t,e,n,r,i,o,g,p,f,a]);d.exports.useEffect(()=>{M&&K.current(m.current,j.current)},[M]),d.exports.useEffect(()=>{!R&&!M&&le()},[R,M,le]),E.current=r,d.exports.useEffect(()=>{if(M&&N){var x,y;(x=w.current)===null||x===void 0||x.dispose(),w.current=(y=m.current)===null||y===void 0?void 0:y.onDidChangeModelContent(_=>{const $=m.current.getValue();E.current!==$&&N($,_)})}},[M,N]),d.exports.useEffect(()=>{if(M){const x=j.current.editor.onDidChangeMarkers(y=>{var _;const $=(_=m.current.getModel())===null||_===void 0?void 0:_.uri;if($&&y.find(re=>re.path===$.path)){const re=j.current.editor.getModelMarkers({resource:$});L?.(re)}});return()=>{x?.dispose()}}},[M,L]);function Ve(){var x;if((x=w.current)===null||x===void 0||x.dispose(),b)f&&Y.set(o,m.current.saveViewState());else{var y;(y=m.current.getModel())===null||y===void 0||y.dispose()}m.current.dispose()}return V.createElement(Ce,{width:v,height:c,isEditorReady:M,loading:h,_ref:U,className:C,wrapperProps:T})}ue.propTypes={defaultValue:s.exports.string,defaultPath:s.exports.string,defaultLanguage:s.exports.string,value:s.exports.string,language:s.exports.string,path:s.exports.string,theme:s.exports.string,line:s.exports.number,loading:s.exports.oneOfType([s.exports.element,s.exports.string]),options:s.exports.object,overrideServices:s.exports.object,saveViewState:s.exports.bool,keepCurrentModel:s.exports.bool,width:s.exports.oneOfType([s.exports.number,s.exports.string]),height:s.exports.oneOfType([s.exports.number,s.exports.string]),className:s.exports.string,wrapperProps:s.exports.object,beforeMount:s.exports.func,onMount:s.exports.func,onChange:s.exports.func,onValidate:s.exports.func};ue.defaultProps={theme:"light",loading:"Loading...",options:{},overrideServices:{},saveViewState:!0,keepCurrentModel:!1,width:"100%",height:"100%",wrapperProps:{},beforeMount:F,onMount:F,onValidate:F};var ve=d.exports.memo(ue);function Le(t,e){return t.toString(16).padStart(e,"0")}function ce(t){return Le(t,2)}function be(t){return Le(t,4)}function Dt(t){const n=/0x(.+)/gm.exec(t);if(n&&n.length>1&&n[1]){const r=parseInt(n[1],16);return isNaN(r)?null:r}return null}function Lt(t){const n=/0d(.+)/gm.exec(t);return n&&n.length>1&&n[1]?Number(n[1]):null}function $t(t){const n=/0b(.+)/gm.exec(t);if(n&&n.length>1&&n[1]){const r=parseInt(n[1],2);return isNaN(r)?null:r}return null}function G(t){return[Dt(t),Lt(t),$t(t)].find(n=>n!==null)??null}class Vt{constructor(e){this.name=e}}class $e{constructor(e){this.name=e}}class A{constructor(e){this.varName=e}}class X{}class u{constructor(e,{value:n,dir:r,source:i,destination:o,variable:a,intLabel:l}){this.mnemonic=e,this.value=n,this.dir=r,this.source=i,this.destination=o,this.variable=a,this.intLabel=l}getCost(){return this.source!==void 0&&this.destination!==void 0?1:this.value!==void 0&&this.destination!==void 0||this.value!==void 0?2:this.source!==void 0?1:this.dir!==void 0||this.intLabel!==void 0?3:1}format(){if(this.source!==void 0&&this.destination!==void 0)return`${this.mnemonic} ${this.source}, ${this.destination}`;if(this.value!==void 0&&this.destination!==void 0){const e=ce(this.value);return`${this.mnemonic} ${e}, ${this.destination}`}else if(this.value!==void 0){const e=ce(this.value);return`${this.mnemonic} ${e}`}else{if(this.source!==void 0)return`${this.mnemonic} ${this.source}`;if(this.dir!==void 0){if(this.dir==="pending-assignation")throw new Error("Could not format, dir is <pending-assignation>");if(this.dir instanceof A)throw new Error("Could not format, linked variable dir is not replaced");if(this.dir instanceof X)throw new Error("Could not format, linked internal label dir is not replaced");const e=be(this.dir);return`${this.mnemonic} ${e}`}else if(this.intLabel!==void 0&&this.intLabel instanceof $e){if(!this.intLabel||this.intLabel.address===void 0)throw new Error("Internal label does not exist or has no address attached");const e=be(this.intLabel.address);return`${this.mnemonic} ${e}`}}return this.mnemonic}}const Bt=/(^\S+)\s=\s([^;]+)/gm,Nt=/show[^\w]+([^;]+)/gm,we=/^(?!if)([^:|]+):[^\w]+(.+)/gm,Ut=/^jmp[^\w]+([^;]+)/gm,Ht=/if[^(]+\(([^)]+)\):[^\w]+(.+)/gm,_t=/^[0-9](d|x|b)?/,qt="+",Ft="-",xe=";",ye=8,Wt=16;class W{constructor(e,n,r=!0){this.code=e,this.initialAddress=n,this.isParent=r,this.lineIndex=0,this.variables=[],this.labels=[],this.instructions=[]}import(e){this.variables=[...e.variables],this.labels=[...e.labels]}syncWith(e,{variables:n=!0,instructions:r=!0}){n&&this.variables.push(...e.variables),r&&this.instructions.push(...e.instructions)}getAllocated(){return this.instructions.map(e=>e.getCost()).reduce((e,n)=>e+n,0)}prepare(e=!0){const n=this.instructions.filter(o=>o.dir==="pending-assignation");if(n.length===0)return;let r=this.initialAddress+this.getAllocated()+Number(e);if(r+n.length>Math.pow(2,Wt)-1)throw new Error("No space left in memory");n.forEach(o=>{const a=n.find(l=>l.variable?.name===o.variable?.name&&typeof l.dir=="number");o.dir=a?Number(a.dir):r++,!a&&o.variable&&typeof o.dir=="number"&&(o.variable.address=o.dir)}),this.instructions.filter(o=>this.variables.find(a=>o.dir instanceof A&&a.name===o.dir.varName)).forEach(o=>{const a=this.variables.find(l=>o.dir instanceof A&&l.name===o.dir.varName);o.dir=a?.address}),e&&this.instructions.push(new u("FIN",{}))}preParseLabels(){let e=0;const n=this.code.split(`
`);for(;e<n.length;){const r=n[e],i=new RegExp(we).exec(r);if(i&&i.length>1){this.preParseLabel(i[1]),e++;continue}e++}}parse(){this.preParseLabels();const e=this.code.split(`
`);for(;this.lineIndex<e.length;){const n=e[this.lineIndex];if(n.length===0){this.lineIndex++;continue}try{if(n&&!n.endsWith(xe))throw new Error(`Expected ${xe} at col ${n.length}`);const r=new RegExp(we).exec(n);if(r&&r.length>1){this.parseLabel(r[1],r[2]),this.lineIndex++;continue}const i=new RegExp(Ht).exec(n);if(i&&i.length>1){this.parseCondition(i[1],i[2]),this.lineIndex++;continue}const o=new RegExp(Bt).exec(n);if(o&&o.length>1){this.parseAsignation(o[1],o[2]),this.lineIndex++;continue}const a=new RegExp(Nt).exec(n);if(a&&a.length>1){this.parseShow(a[1]),this.lineIndex++;continue}const l=new RegExp(Ut).exec(n);if(l&&l.length>1){this.parseJmp(l[1]),this.lineIndex++;continue}throw new Error("Line could not be parsed")}catch(r){throw this.isParent&&r instanceof Error?new Error(`Line ${this.lineIndex+1}: ${r.message}`):r}}}parseFn(e){throw new Error("Not implemented")}parseAsignationInmediateSource(e){const n=[],r=G(e);if(r!==null&&r>Math.pow(2,ye)-1)throw new Error(`Value ${ce(r)} overflows ${ye} value bits`);if(r!==null){const i=[new u("MOV",{value:r,destination:"AC"})];n.push(...i)}return n}parseAsignationOtherSource(e){const n=[],r=/([^\s]+)[^\w]+(\+|-)[^\w]+(.+)/gm,i=new RegExp(`(${this.variables.map(l=>l.name).join("|")})$`,"gm"),o=r.exec(e),a=i.exec(e);if(o&&o.length>1&&o[1]&&o[2]&&o[3]){const l=o[1],h=o[2],g=o[3],p=G(l),f=G(g),b=this.variables.find(c=>c.name===l),v=this.variables.find(c=>c.name===g);if(p===null&&!b)throw new Error(`Arithmetical operand (variable or number) ${l} is not valid`);if(f===null&&!v)throw new Error(`Arithmetical operand (variable or number) ${g} is not valid`);if(h===qt){const c=[];p!==null&&c.length===0?c.push(new u("MOV",{destination:"AC",value:p}),new u("MOV",{source:"AC",destination:"RB"})):p!==null&&c.length>0&&c.push(new u("ADD",{value:p})),f!==null&&c.length===0?c.push(new u("MOV",{destination:"AC",value:f}),new u("MOV",{source:"AC",destination:"RB"})):f!==null&&c.length>0&&c.push(new u("ADD",{value:f})),b&&c.length===0?c.push(new u("LDA",{dir:new A(b.name)}),new u("MOV",{source:"AC",destination:"RB"})):b&&c.length>0&&c.push(new u("LDA",{dir:new A(b.name)}),new u("ADD",{source:"RB"})),v&&c.length===0?c.push(new u("LDA",{dir:new A(v.name)}),new u("MOV",{source:"AC",destination:"RB"})):v&&c.length>0&&c.push(new u("LDA",{dir:new A(v.name)}),new u("ADD",{source:"RB"})),n.push(...c)}else if(h===Ft){const c=[];p!==null&&c.length===0?c.push(new u("MOV",{destination:"AC",value:p}),new u("MOV",{source:"AC",destination:"RB"})):p!==null&&c.length>0&&c.push(new u("SUB",{value:p})),f!==null&&c.length===0?c.push(new u("MOV",{destination:"AC",value:f}),new u("MOV",{source:"AC",destination:"RB"})):f!==null&&c.length>0&&c.push(new u("SUB",{value:f})),b&&c.length===0?c.push(new u("LDA",{dir:new A(b.name)}),new u("MOV",{source:"AC",destination:"RB"})):b&&c.length>0&&c.push(new u("LDA",{dir:new A(b.name)}),new u("SUB",{source:"RB"})),v&&c.length===0?c.push(new u("LDA",{dir:new A(v.name)}),new u("MOV",{source:"AC",destination:"RB"})):v&&c.length>0&&c.push(new u("LDA",{dir:new A(v.name)}),new u("SUB",{source:"RB"})),n.push(...c)}else throw new Error(`Arithmetical operation ${h} is not recognized`)}else if(a&&a.length>1&&a[1]){const l=[new u("LDA",{dir:new A(a[1])})];n.push(...l)}return n}parseAsignation(e,n){if(_t.test(e))throw new Error(`Variable declaration '${e}' is not valid`);const r=this.parseAsignationOtherSource(n),i=this.parseAsignationInmediateSource(n);let o=this.variables.find(a=>a.name===e);if(o||(o=new Vt(e),this.variables.push(o)),r.length>0){const a=new u("STA",{dir:"pending-assignation",variable:o});r.push(a),this.instructions.push(...r)}else if(i.length>0){const a=new u("STA",{dir:"pending-assignation",variable:o});i.push(a),this.instructions.push(...i)}else throw new Error(`Unknown source ${n}`)}parseShow(e){if(!this.variables.find(i=>i.name===e))throw new Error(`Referenced variable ${e} is not defined`);const r=[new u("LDA",{dir:new A(e)})];this.instructions.push(...r)}preParseLabel(e){let n=this.labels.find(r=>r.name===e);n||(n=new $e(e),this.labels.push(n))}parseLabel(e,n){const r=this.labels.find(a=>a.name===e);if(!r)throw new Error(`Label ${e} missmatch with pre`);const i=this.getAllocated();r.address=i;const o=new W(n,r.address,!1);o.import(this),o.parse(),this.syncWith(o,{instructions:!0,variables:!0})}parseJmp(e){const n=this.labels.find(i=>i.name===e);if(!n)throw new Error(`Referenced label ${e} is not defined`);const r=[new u("JMP",{intLabel:n})];this.instructions.push(...r)}loadInput(e,n){const r=[],i=G(e),o=this.variables.find(a=>a.name===e);if(!o&&i===null)throw new Error(`${e} is not recognized`);return i!==null&&r.push(new u("MOV",{value:i,destination:n})),o&&(r.push(new u("LDA",{dir:new A(o?.name)})),n!=="AC"&&r.push(new u("MOV",{source:"AC",destination:n}))),r}parseCondition(e,n){const i=/([^\s]+)[^=]+(==|!=|>=|<=|>|<)[^\w]+([^\s]+)/gm.exec(e);if(!i||i.length!==4)throw new Error("Invalid conditional");const o=i[1],a=i[2],l=i[3],h=this.loadInput(l,"RB"),g=this.loadInput(o,"AC");switch(this.instructions.push(...h,...g),a){case"==":{this.instructions.push(new u("CMP",{source:"RB"}));const p=this.getAllocated(),f=new u("BEQ",{dir:new X}),b=new u("JMP",{dir:new X}),v=f.getCost(),c=b.getCost();this.instructions.push(f,b);const C=p+v+c,T=new W(n,C,!1);T.import(this),T.parse(),this.syncWith(T,{instructions:!0,variables:!0});const B=C+T.getAllocated();f.dir=C,b.dir=B;break}case"!=":{this.instructions.push(new u("CMP",{source:"RB"}));const p=this.getAllocated(),f=new u("BEQ",{dir:new X}),b=f.getCost();this.instructions.push(f);const v=p+b,c=new W(n,v,!1);c.import(this),c.parse(),this.syncWith(c,{instructions:!0,variables:!0});const C=v+c.getAllocated();f.dir=C;break}}}}function kt(t,e){const n=new W(t,e,!0);return n.parse(),n.prepare(),{result:n.instructions,variables:n.variables}}function Qt({code:t}){const[e,n]=d.exports.useState(t),[r,i]=d.exports.useState(),[o,a]=d.exports.useState(""),[l,h]=d.exports.useState([]),g=d.exports.useRef(null);return d.exports.useEffect(()=>{a("");try{const{result:p,variables:f}=kt(e,0);let b=[...new Map(f.map(v=>[v.name,v])).values()];h(b),i(p)}catch(p){i(null),p instanceof Error&&a(p.message)}},[e]),O.exports.jsxs(O.exports.Fragment,{children:[O.exports.jsx("p",{style:{color:"red"},children:o}),O.exports.jsxs("div",{style:{width:"100%",display:"flex"},children:[O.exports.jsx(ve,{height:"40vh",width:"50%",value:e,onChange:p=>n(p||""),defaultLanguage:"mpp",defaultValue:t,onMount:(p,f)=>g.current=p}),O.exports.jsx(ve,{height:"40vh",width:"50%",options:{readOnly:!0,lineNumbers:p=>{const f=p-1,v=(r?.slice(0,f)??[])?.map(c=>c.getCost()).reduce((c,C)=>c+C,0);return Number(v).toString(16).padStart(4,"0").toUpperCase()}},value:r===null?"":r?.map(p=>p.format()).join(`
`),defaultLanguage:"assembly",defaultValue:""})]}),O.exports.jsxs(O.exports.Fragment,{children:[O.exports.jsx("h2",{children:"Variables info"}),O.exports.jsxs("table",{children:[O.exports.jsx("thead",{children:O.exports.jsxs("tr",{children:[O.exports.jsx("th",{children:"Variable"}),O.exports.jsx("th",{children:"Address"})]})}),O.exports.jsx("tbody",{children:l.map(p=>O.exports.jsxs("tr",{children:[O.exports.jsx("td",{children:p.name}),O.exports.jsx("td",{children:p.address?.toString(16).padStart(4,"0").toUpperCase()})]},p.name))})]})]})]})}export{Qt as default};
